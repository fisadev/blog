<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Encrypt a dir with Ecryptfs | Blog (fisa)</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="http://blog.fisadev.com/posts/encrypt-a-dir-with-ecryptfs/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Juan Pedro Fisanotti">
<link rel="prev" href="../daneluz-longsword-best-sword/" title="Longsword by Leonardo Daneluz, my best sword!" type="text/html">
<meta property="og:site_name" content="Blog (fisa)">
<meta property="og:title" content="Encrypt a dir with Ecryptfs">
<meta property="og:url" content="http://blog.fisadev.com/posts/encrypt-a-dir-with-ecryptfs/">
<meta property="og:description" content="This is a simple tutorial on how to have an encrypted directory in your Linux, by using Ecryptfs.
There are many alternatives to do the same, and I'm not qualified to do a deep comparison of them.
But">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-03-11T20:30:00-03:00">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
            <header id="header"><h1 id="brand"><a href="http://blog.fisadev.com/" title="Blog (fisa)" rel="home">

        <span id="blog-title">Blog (fisa)</span>
    </a></h1>

        
            <nav id="menu"><ul>
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>

    
    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Encrypt a dir with Ecryptfs</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Juan Pedro Fisanotti
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-03-11T20:30:00-03:00" itemprop="datePublished" title="2020-03-11 20:30">2020-03-11 20:30</time></a>
            </p>
                <p class="commentline">            <a href="#disqus_thread" data-disqus-identifier="cache/posts/encrypt-dir.html">Comments</a>


                    </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This is a simple tutorial on how to have an encrypted directory in your Linux, by using Ecryptfs.</p>
<p>There are many alternatives to do the same, and I'm not qualified to do a deep comparison of them.
But I've been using this solution for many years already, and it works like a charm.
It relies on command line tools only which are easy to automate.
And because it uses a mounted filesystem, it's pretty transparent to other tools (like backups,
editors, etc).
There's absolutely no need for specialized tools to work with your encrypted files.</p>
<div class="section" id="dependencies">
<h2>Dependencies</h2>
<pre class="code bash"><a name="rest_code_59217b105cf94af2a4e64ff4d7f383f1-1"></a>sudo apt install ecryptfs-utils
</pre>
</div>
<div class="section" id="initial-setup-one-time-only">
<h2>Initial setup (one time only)</h2>
<p>You need to do this only once to setup your dir.
After that you won't have to run these steps in your daily use.</p>
<p>First create two dirs:</p>
<ul class="simple">
<li><p>A dir where you will work with your files when the encrypted filesystem is mounted.</p></li>
<li><p>A dir where the encrypted data will live. You should <strong>never</strong> edit its contents by yourself.</p></li>
</ul>
<pre class="code bash"><a name="rest_code_40debb613f344c37a24aeaa5329baa73-1"></a>mkdir super_secret_things
<a name="rest_code_40debb613f344c37a24aeaa5329baa73-2"></a>mkdir super_secret_things_encrypted
</pre>
<p>Then, mount the filesystem for the first time:</p>
<pre class="code bash"><a name="rest_code_ca5372a25e4a46e99781ccf9236bd0d5-1"></a>sudo mount super_secret_things_encrypted super_secret_things -t ecryptfs
</pre>
<p>This will ask you a bunch of questions, these are the answers I recommend, plus some explanations:</p>
<ul class="simple">
<li><p><strong>Passphrase</strong>: whatever you want to use as password :)</p></li>
<li><p><strong>Cipher</strong>: aes (option 1. This is the algorithm used to encrypt. Aes is pretty good)</p></li>
<li><p><strong>Key bytes</strong>: 32 (option 2. The size of the key, bigger usually means harder to hack)</p></li>
<li><p><strong>Plaintext passthrough</strong>: no (this allows for non-encrypted files to be used along encrypted ones,
which I think is a bad idea. These are your super secret stuff, you need to be sure they are
always encrypted).</p></li>
<li><p><strong>Filename encryption</strong>: yes (fairly obvious. If the answer is no, people can see the names of the
files without having to know the encryption password)</p></li>
<li><p><strong>Signature confirmation</strong>: just press enter.</p></li>
<li><p>A confirmation asking whether you are sure you typed everything right, because this is the first
time ecryptfs sees you using this combination of parameters with this directory. Just say yes,
because doh, of course it's the first time.</p></li>
<li><p>And Finally, whether you want ecryptfs to remember the answer to the previous question, so it
doesn't ask you "are you sure? this is the first time..." every time you mount the encrypted dir.
Answer yes.</p></li>
</ul>
<p><strong>You will need to remember the answers</strong> you chose, to be able to re-mount the encrypted dir in
the future! For me this became muscle memory: "1 2 n y enter".</p>
<p>And that's it! Encrypted dir created!</p>
</div>
<div class="section" id="daily-use">
<h2>Daily use</h2>
<p>Whenever you need to work with your encrypted files, the steps are this:</p>
<ol class="arabic simple">
<li><p>Mount the encrypted dir</p></li>
</ol>
<pre class="code bash"><a name="rest_code_9b8661c9dbbd4648b19a5e3ac716fccc-1"></a>sudo mount super_secret_things_encrypted super_secret_things -t ecryptfs
<a name="rest_code_9b8661c9dbbd4648b19a5e3ac716fccc-2"></a><span class="c1"># answer "1 2 n y enter", or whatever you chose instead</span>
</pre>
<p>You can also avoid having to answer all the questions, by passing all these extra parameters:</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 82)</p>
<p>Error in "code" directive:
maximum 1 argument(s) allowed, 35 supplied.</p>
<pre class="literal-block">.. code:: bash
    sudo mount super_secret_things_encrypted super_secret_things -t ecryptfs -o ecryptfs_cipher=aes,ecryptfs_key_bytes=32,ecryptfs_passthrough=n,ecryptfs_enable_filename_crypto=y,ecryptfs_fnek_sig=6b8de1a1e22ae45c
    # (the "encryptfs_fnek_sig" signature is the one that the mount command asks you to verify in the final step, when not receiving all the extra params)

</pre>
</div>
<ol class="arabic simple" start="2">
<li><p>Work with your files inside <cite>super_secret_things</cite> (REMEMBER!!! never edit the contents of <cite>super_secret_things_encrypted</cite> by yourself)</p></li>
<li><p>Un-mount the encrypted dir</p></li>
</ol>
<pre class="code bash"><a name="rest_code_8cd78fd8617d413881def48501d5af1b-1"></a>sudo umount super_secret_things
</pre>
<p>Of course, you can automate these into scripts, alias in your shell, etc.</p>
<p>Hope this is as useful to you as it was for me :)</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../daneluz-longsword-best-sword/" rel="prev" title="Longsword by Leonardo Daneluz, my best sword!">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="fisa-blog",
            disqus_url="http://blog.fisadev.com/posts/encrypt-a-dir-with-ecryptfs/",
        disqus_title="Encrypt a dir with Ecryptfs",
        disqus_identifier="cache/posts/encrypt-dir.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="fisa-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer id="footer"><p>Contents Â© 2020         <a href="mailto:fisadev@gmail.com">Juan Pedro Fisanotti</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
                <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-10031421-14"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-10031421-14');
    </script>
</body>
</html>
