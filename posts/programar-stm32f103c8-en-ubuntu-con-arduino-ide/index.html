<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Cómo hacer que todo eso funcione.">
<meta name="viewport" content="width=device-width">
<title>Programar STM32F103C8 en Ubuntu con Arduino IDE | Blog (fisa)</title>
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://blog.fisadev.com/posts/programar-stm32f103c8-en-ubuntu-con-arduino-ide/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Juan Pedro Fisanotti">
<link rel="prev" href="../separate-io-from-algorithms/" title="Separate IO from algorithms" type="text/html">
<link rel="next" href="../art-killer-ai/" title="On AI killing art, and other fears" type="text/html">
<meta property="og:site_name" content="Blog (fisa)">
<meta property="og:title" content="Programar STM32F103C8 en Ubuntu con Arduino IDE">
<meta property="og:url" content="http://blog.fisadev.com/posts/programar-stm32f103c8-en-ubuntu-con-arduino-ide/">
<meta property="og:description" content="Cómo hacer que todo eso funcione.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-08-04T09:48:13-03:00">
<meta property="article:tag" content="arduino">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../archive.html">Archive</a>
        <a class="sidebar-nav-item" href="../../categories/">Tags</a>
        <a class="sidebar-nav-item" href="../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="http://blog.fisadev.com/" title="Blog (fisa)" rel="home">Blog (fisa)</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Programar STM32F103C8 en Ubuntu con Arduino IDE</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Pedro Fisanotti</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2022-08-04T09:48:13-03:00" itemprop="datePublished" title="2022-08-04 09:48">2022-08-04 09:48</time></a></p>
                <p class="commentline">
    
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/programar-stm32f103c8-en-ubuntu-con-arduino-ide.html">Comments</a>


                <meta name="description" itemprop="description" content="Cómo hacer que todo eso funcione."></p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Hacer andar una placa STM32F103C8 (o cualquier STM32 de hecho) con Arduino IDE en Ubuntu no es tan simple, hay muchos tutoriales e info contradictoria en la web.</p>
<p>Esto es lo que en mi caso funcionó, en un Ubuntu 20.04 LTS.</p>
<p>Este tutorial asume que ya tienen instalado Arduino IDE, de una versión relativamente actual.</p>
<section id="paso-1-agregar-soporte-de-stm32-en-arduino-ide"><h2>Paso 1: Agregar soporte de STM32 en Arduino IDE</h2>
<p>Lo primero que hay que hacer es instalar los plugins necesarios en Arduino IDE, para que el editor sepa compilar y grabar programas en las placas STM32.</p>
<p>Para ello tenemos que ir al menú "File", opción "Preferences", y en la ventana que se nos abre, clickear el botón que está al lado de Additional Board Manager URLs:</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/menu_preferences.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/menu_preferences.png"><img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/boton_boards_urls.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/boton_boards_urls.png"><p>En la segunda ventana que se nos abre debemos agregar la URL de donde Arduino IDE va a bajar toda la información de estas placas. La url es esta:</p>
<div class="code"><pre class="code text"><a id="rest_code_c6b6d48f3aa24cc2b8fc9dd67e668e2e-1" name="rest_code_c6b6d48f3aa24cc2b8fc9dd67e668e2e-1" href="#rest_code_c6b6d48f3aa24cc2b8fc9dd67e668e2e-1"></a>http://dan.drown.org/stm32duino/package_STM32duino_index.json
</pre></div>
<p>Y debe agregarse al final, en un renglón nuevo (si es que ya teníamos otras URLs en esta configuración, como es mi caso), y clickear en "Ok":</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/board_url_agregada.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/board_url_agregada.png"><p>Luego debemos decirle a Arduino IDE que se baje desde esa URL la información que necesitamos para controlar nuestra placa STM32. Para ello vamos al menú "Tools", luego "Board", y elegimos la opción "Boards Manager..."</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/menu_boards_manager.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/menu_boards_manager.png"><p>En la ventana que se nos abre tenemos la posibilidad de filtrar la lista de plugins de Arduino IDE. Tenemos que buscar los que nos interesan, escribiendo "STM32" en la caja de búsqueda. Y de los resultados, tenemos que elegir el que dice "STM32F1xx/GD32F1xx boards". Luego de elegirlo nos va a aparecer un botón de "Install" para ese plugin, al que le hacemos click y esperamos que termine el progreso de la instalación.</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/install_stm32_plugin.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/install_stm32_plugin.png"><p>Cuando termina su instalación, podemos cerrar la ventana del Board Manager.</p>
</section><section id="paso-2-elegir-nuestra-placa-y-la-forma-de-programarla"><h2>Paso 2: Elegir nuestra placa y la forma de programarla</h2>
<p>Ahora tenemos que decirle a Arduino IDE que queremos trabajar con esa placa nueva que instalamos. Para ello elegimos en el menú "Tools", "Board", "STM32F1 Boards", la opción "Generic STM32F103C series":</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_board.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_board.png"><p>Al hacer eso se nos van a agregar algunas opciones nuevas en el menú "Tools", de las cuales tenemos que elegir dos más:</p>
<p>"Tools", "Variant", "STM32F103C8"</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_variant.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_variant.png"><p>"Tools", "Upload Method", "STLink"</p>
<img alt="/images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_upload.png" src="../../images/programar-stm32f103c8-en-ubuntu-con-arduino-ide/elegir_upload.png"></section><section id="paso-3-arreglar-cosas-que-no-deberian-estar-rotas"><h2>Paso 3: Arreglar cosas que no deberían estar rotas</h2>
<p>Con los pasos que hicimos antes, en un mundo ideal y con placas más normales, ya todo queda listo para poder programar, hacer click en Play, y que nuestro código corra en la placa que tenemos conectada a la PC. Pero en el caso de las STM32 esto está roto, y hay que hacer algunos pasos manuales para arreglarlo. Los descubrí probando y renegando, y probablemente esto cambie en el futuro.</p>
<p>En particular: el plugin de Arduino IDE para las STM trae dentro un programita que se usa para flashear la placa, llamado "stlink-tools". Pero el problema es que trae una versión vieja y rota (al menos rota en entornos modernos).</p>
<p>Así que lo primero que vamos a hacer, es eliminar esa versión vieja de ese programita que no sirve de dentro del plugin. Lo hacemos corriendo este comando en una terminal de linux:</p>
<div class="code"><pre class="code text"><a id="rest_code_4c54c6ea359a441e90b6d6d173fd87e3-1" name="rest_code_4c54c6ea359a441e90b6d6d173fd87e3-1" href="#rest_code_4c54c6ea359a441e90b6d6d173fd87e3-1"></a>rm ~/.arduino15/packages/stm32duino/tools/stm32tools/2021.5.31/linux/stlink/st-*
</pre></div>
<p>Si el comando dispara un error diciendo que los archivos no existen, lo más probable es que tengan alguna versión diferente o de Arduino IDE, o del plugin. En ese caso van a necesitar encontrar cuál es la ruta para el caso particular de ustedes (probablemente si es otra versión de Arduino IDE, cambie el nombre del directorio <cite>.arduino15</cite>, o si es otra versión del plugin, cambie el nombre del directorio <cite>2021.5.31</cite>).</p>
<p>Una vez borrados esos archivos, tenemos que instalar una mejor versión de la herramienta "stlink-tools". Hacemos eso con este comando:</p>
<div class="code"><pre class="code text"><a id="rest_code_538b4f0a51c84817848b1cc9d2f929c9-1" name="rest_code_538b4f0a51c84817848b1cc9d2f929c9-1" href="#rest_code_538b4f0a51c84817848b1cc9d2f929c9-1"></a>sudo apt install stlink-tools
</pre></div>
<p>Esperamos a que termine de bajar e instalar, y luego tenemos que hacer un último pasito: indicarle a Arduino IDE que use nuestro nuevo stlink tools. Para ello corremos estos tres comandos. Pero ojo!! La ruta que estamos usando acá tiene que ser la misma que la que usamos antes para borrar el viejo stlink tools del plugin. Si cambiamos algún nombre de directorio en el paso de borrado, acá también deberíamos cambiarlo de la misma forma:</p>
<div class="code"><pre class="code text"><a id="rest_code_6875595236ff43bea59b17ae958acb2f-1" name="rest_code_6875595236ff43bea59b17ae958acb2f-1" href="#rest_code_6875595236ff43bea59b17ae958acb2f-1"></a>ln -s /usr/bin/st-flash ~/.arduino15/packages/stm32duino/tools/stm32tools/2021.5.31/linux/stlink/
<a id="rest_code_6875595236ff43bea59b17ae958acb2f-2" name="rest_code_6875595236ff43bea59b17ae958acb2f-2" href="#rest_code_6875595236ff43bea59b17ae958acb2f-2"></a>ln -s /usr/bin/st-info ~/.arduino15/packages/stm32duino/tools/stm32tools/2021.5.31/linux/stlink/
<a id="rest_code_6875595236ff43bea59b17ae958acb2f-3" name="rest_code_6875595236ff43bea59b17ae958acb2f-3" href="#rest_code_6875595236ff43bea59b17ae958acb2f-3"></a>ln -s /usr/bin/st-util ~/.arduino15/packages/stm32duino/tools/stm32tools/2021.5.31/linux/stlink/
</pre></div>
</section><section id="listo"><h2>Listo!</h2>
<p>Con estos pasos hechos, ya deberíamos poder hacer un programa de ejemplo en Arduino IDE, y al apretar el botón de play (la flecha hacia la derecha) nuestro programa debería ejecutarse en la placa :)</p>
<p>Un programa de ejemplo que vi usado en muchos de los tutoriales (desconozco su autor original, si no lo linkearía):</p>
<div class="code"><pre class="code text"><a id="rest_code_57d548a09da9467ca37137a779556b94-1" name="rest_code_57d548a09da9467ca37137a779556b94-1" href="#rest_code_57d548a09da9467ca37137a779556b94-1"></a>const int ledPIN = PC13;
<a id="rest_code_57d548a09da9467ca37137a779556b94-2" name="rest_code_57d548a09da9467ca37137a779556b94-2" href="#rest_code_57d548a09da9467ca37137a779556b94-2"></a>
<a id="rest_code_57d548a09da9467ca37137a779556b94-3" name="rest_code_57d548a09da9467ca37137a779556b94-3" href="#rest_code_57d548a09da9467ca37137a779556b94-3"></a>void setup()
<a id="rest_code_57d548a09da9467ca37137a779556b94-4" name="rest_code_57d548a09da9467ca37137a779556b94-4" href="#rest_code_57d548a09da9467ca37137a779556b94-4"></a>{
<a id="rest_code_57d548a09da9467ca37137a779556b94-5" name="rest_code_57d548a09da9467ca37137a779556b94-5" href="#rest_code_57d548a09da9467ca37137a779556b94-5"></a>  pinMode(ledPIN, OUTPUT);
<a id="rest_code_57d548a09da9467ca37137a779556b94-6" name="rest_code_57d548a09da9467ca37137a779556b94-6" href="#rest_code_57d548a09da9467ca37137a779556b94-6"></a>}
<a id="rest_code_57d548a09da9467ca37137a779556b94-7" name="rest_code_57d548a09da9467ca37137a779556b94-7" href="#rest_code_57d548a09da9467ca37137a779556b94-7"></a>
<a id="rest_code_57d548a09da9467ca37137a779556b94-8" name="rest_code_57d548a09da9467ca37137a779556b94-8" href="#rest_code_57d548a09da9467ca37137a779556b94-8"></a>void loop()
<a id="rest_code_57d548a09da9467ca37137a779556b94-9" name="rest_code_57d548a09da9467ca37137a779556b94-9" href="#rest_code_57d548a09da9467ca37137a779556b94-9"></a>{
<a id="rest_code_57d548a09da9467ca37137a779556b94-10" name="rest_code_57d548a09da9467ca37137a779556b94-10" href="#rest_code_57d548a09da9467ca37137a779556b94-10"></a>  digitalWrite(ledPIN, HIGH);
<a id="rest_code_57d548a09da9467ca37137a779556b94-11" name="rest_code_57d548a09da9467ca37137a779556b94-11" href="#rest_code_57d548a09da9467ca37137a779556b94-11"></a>  delay(1000);
<a id="rest_code_57d548a09da9467ca37137a779556b94-12" name="rest_code_57d548a09da9467ca37137a779556b94-12" href="#rest_code_57d548a09da9467ca37137a779556b94-12"></a>  digitalWrite(ledPIN, LOW);
<a id="rest_code_57d548a09da9467ca37137a779556b94-13" name="rest_code_57d548a09da9467ca37137a779556b94-13" href="#rest_code_57d548a09da9467ca37137a779556b94-13"></a>  delay(1000);
<a id="rest_code_57d548a09da9467ca37137a779556b94-14" name="rest_code_57d548a09da9467ca37137a779556b94-14" href="#rest_code_57d548a09da9467ca37137a779556b94-14"></a>}
</pre></div>
<p>Si todo anduvo bien, al dar play el led verde de nuestra placa STM32F103C8 debería titilar exáctamente cada 1 segundo :)</p>
</section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/arduino/" rel="tag">arduino</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../separate-io-from-algorithms/" rel="prev" title="Separate IO from algorithms">Previous post</a>
            </li>
            <li class="next">
                <a href="../art-killer-ai/" rel="next" title="On AI killing art, and other fears">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="fisa-blog",
            disqus_url="http://blog.fisadev.com/posts/programar-stm32f103c8-en-ubuntu-con-arduino-ide/",
        disqus_title="Programar STM32F103C8 en Ubuntu con Arduino IDE",
        disqus_identifier="cache/posts/programar-stm32f103c8-en-ubuntu-con-arduino-ide.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="fisa-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2024         <a href="mailto:fisadev@gmail.com">Juan Pedro Fisanotti</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-10031421-14"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-10031421-14');
    </script><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
