<!DOCTYPE html>
<html prefix="
            og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is my personal blog.">
<meta name="viewport" content="width=device-width">
<title>Blog (fisa)</title>
<link href="assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="assets/css/code.css" rel="stylesheet" type="text/css">
<link href="assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://blog.fisadev.com/">
<!--[if lt IE 9]><script src="assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link rel="prefetch" href="posts/customer-and-code-quality/" type="text/html">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><h1 id="brand"><a href="http://blog.fisadev.com/" title="Blog (fisa)" rel="home">

        <span id="blog-title">Blog (fisa)</span>
    </a></h1>

        
            <nav id="menu"><ul>
<li><a href="archive.html">Archive</a></li>
                <li><a href="categories/">Tags</a></li>
                <li><a href="rss.xml">RSS feed</a></li>
    
    
    </ul></nav></header><main id="content"><div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/customer-and-code-quality/" class="u-url">Customer and code quality</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Juan Pedro Fisanotti
            </span></p>
            <p class="dateline"><a href="posts/customer-and-code-quality/" rel="bookmark"><time class="published dt-published" datetime="2017-09-17T16:28:30-03:00" title="2017-09-17 16:28">2017-09-17 16:28</time></a></p>
                <p class="commentline">            <a href="posts/customer-and-code-quality/#disqus_thread" data-disqus-identifier="cache/posts/customer-and-code-quality.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I hear this a lot in the software development community: "the customer doesn't care about the quality of the code, just about features, usability, user experience, etc.".
It has many variations, but the idea remains the same: code quality isn't a factor in the decisions of the customer (internal or external).</p>
<p>Sometimes it's even used to justify writing, or not refactoring, bad code.
Because the main thing is to give your customer some value, and code quality just doesn't do that.</p>
<p>I currently believe this is false.
I believe that <strong>customers do care</strong> about the quality of the code, even if they don't understand what code is or how does it work.</p>
<div class="section" id="cars">
<h2>Cars</h2>
<p>When buying a car, would you ask how are the wheels attached to the rest of the car?
You probably wouldn't, you don't care about that.
But what if car X had wheels so special that each time you must change a tire, you need to spend 10.000$?
Suddenly you care about wheel attachment systems.
You would even feel cheated if someone sold you this car without warning you about its wheels.</p>
<p>Well, no, you don't care about wheel attachment systems specifically.
But you don't want a car that costs lots of money each time it requires some maintainance.
You care about <strong>maintainance costs</strong>.</p>
</div>
<div class="section" id="software">
<h2>Software</h2>
<p>You probably get my point already.</p>
<p>Software, code, will need maintainance in most projects.
And we know that one of the major factors defining the time (money) required to do code maintainance, is how good it is.
Bad code costs more to maintain because it tends to have more bugs, to spawn new bugs more easily when modifying it, to be harder to read/understand how to change it, etc.</p>
<p>So the customer might have zero idea regarding what code is.
But they still <strong>care</strong>, they want software with reasonable maintainance costs and that means code that is decent enough.
And giving them bad code without warning them of its impacts in maintainance, is a way of cheating them.</p>
<p>Finally, customers tend to be unable to see this relation by themselves, and contractors usually don't want to tell them "this is taking too long to modify because we gave you bad quality code".
This may be the reason we got the idea that customers don't care about code, developers just usually fail to explain (or even hide) to them the strong relation between code quality and maintainance costs.
So they never come back asking for "better code".</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/como-saber-si-hay-un-satelite-argentino-arriba-tuyo/" class="u-url">Cómo saber si hay un satélite argentino arriba tuyo</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Juan Pedro Fisanotti
            </span></p>
            <p class="dateline"><a href="posts/como-saber-si-hay-un-satelite-argentino-arriba-tuyo/" rel="bookmark"><time class="published dt-published" datetime="2017-09-06T20:14:38-03:00" title="2017-09-06 20:14">2017-09-06 20:14</time></a></p>
                <p class="commentline">            <a href="posts/como-saber-si-hay-un-satelite-argentino-arriba-tuyo/#disqus_thread" data-disqus-identifier="cache/posts/como-saber-si-hay-un-satelite-argentino-arriba-tuyo.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>No te gustaría poder ver algo como esto en tu máquina, para saber cuándo alguno de los satélites argentinos anda por el cielo que está arriba tuyo?:</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/preview.png"><img alt="/images/satelites-arriba-tuyo/preview.thumbnail.png" src="images/satelites-arriba-tuyo/preview.thumbnail.png"></a>
<p>Parece algo salido de una película, es re interesante para curiosear, y lo mejor de todo es que es una pavada tenerlo. Está todo disponible con programas y datos libres y gratuitos, y sin tener que hacer casi nada de trabajo. Así que les dejo los pasos para reproducirlo:</p>
<div class="section" id="programa-y-datos">
<h2>Programa y datos</h2>
<p>Primero que nada necesitamos instalar GPredict, el programa que hace todo esto. Se puede bajar desde el sitio oficial: <a class="reference external" href="http://gpredict.oz9aec.net/">http://gpredict.oz9aec.net/</a></p>
<p>Para quienes estén en Ubuntu, pueden instalarlo desde los repositorios:</p>
<pre class="code text"><a name="rest_code_ad5dcdd6df5a4f37927ef4c60ad0953d-1"></a>sudo apt install gpredict
</pre>
<p>Lo abrimos y por primera vez vamos a ver un dashboard un poco diferente al que mostré, con datos de satélites y la estación espacial internacional.
Vamos a decirle que se baje datos actualizados, así las órbitas que vemos tienen menos error: vamos al menú "Edit" &gt; "Update TLE" &gt; "From network".
Eso nos va a mostrar una ventana con el progreso de la actualización, solamente tenemos que esperar a que termine (unos segundos) y luego cerrar la ventana.</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/update.png"><img alt="/images/satelites-arriba-tuyo/update.thumbnail.png" src="images/satelites-arriba-tuyo/update.thumbnail.png"></a>
</div>
<div class="section" id="configurar-que-queremos-ver">
<h2>Configurar qué queremos ver</h2>
<p>Ahora solo tenemos que decirle al programa dos cosas: qué queremos ver, y dónde estamos.</p>
<p>Vamos al menú "File" &gt; "New module", lo que nos va a mostrar una ventana como esta:</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/new_module.png"><img alt="/images/satelites-arriba-tuyo/new_module.thumbnail.png" src="images/satelites-arriba-tuyo/new_module.thumbnail.png"></a>
<p>Rellenamos:</p>
<ul class="simple">
<li>"Module Name": nombre de nuestro dashboard.</li>
<li>"Selected Satellites": los satélites que queremos ver, que agregamos haciendo doble click en la lista de la izquierda ("Available Satellites"). Por suerte permite buscar :)
Los satélites argentinos actuales son los <strong>CUBEBUG, NUSAT y ARSAT (hay varios de cada tipo, NUSAT-3 por ejemplo es el Milanesat de Satellogic!)</strong>.</li>
</ul>
<p>Guardamos, y terminamos con algo como esta imagen:</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/initial_dashboard.png"><img alt="/images/satelites-arriba-tuyo/initial_dashboard.thumbnail.png" src="images/satelites-arriba-tuyo/initial_dashboard.thumbnail.png"></a>
<p>Todavía no se ve muy lindo, y falta nuestra posición. Pero ya podemos ver la posición actual de los satélites que nos interesaban!</p>
<p>Agreguemos nuestra posición. Para ello hay que editar el módulo (dashboard), lo hacemos desplegando el menú que se abre con este botón (arriba a la derecha, en la esquina del mapa) y eligiendo la opción "Configure":</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/menu_button.png"><img alt="/images/satelites-arriba-tuyo/menu_button.thumbnail.png" src="images/satelites-arriba-tuyo/menu_button.thumbnail.png"></a>
<p>En la ventana que se nos abre (que es la misma que cuando creamos el dashboard), hacemos click en el botón con un signo "+" que está al lado de "Ground Station".
Ello nos abre una ventana donde rellenar nuestra posición:</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/add_ground_station.png"><img alt="/images/satelites-arriba-tuyo/add_ground_station.thumbnail.png" src="images/satelites-arriba-tuyo/add_ground_station.thumbnail.png"></a>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/ground_station.png"><img alt="/images/satelites-arriba-tuyo/ground_station.thumbnail.png" src="images/satelites-arriba-tuyo/ground_station.thumbnail.png"></a>
<p>Lo importante a rellenar es "Name", "Latitude" y "Longitude" (datos que podemos obtener con el gps del celular, usando aplicaciones <a class="reference external" href="https://play.google.com/store/apps/details?id=com.wered.sensorsmultitool">como esta</a>). "Altitud" también es útil, pero no super importante.</p>
<p>Guardamos la ubicación, y ahora en la misma pantalla de edición del dashboard, vamos a hacer un último paso para que se vea un poco más lindo (al menos a mi gusto, jeje).
Hacemos click en el botón "Properties". Esto nos despliega una ventana, en la que solo nos interesa cambiar el valor de "Select layout":</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/edit_properties.png"><img alt="/images/satelites-arriba-tuyo/edit_properties.thumbnail.png" src="images/satelites-arriba-tuyo/edit_properties.thumbnail.png"></a>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/properties.png"><img alt="/images/satelites-arriba-tuyo/properties.thumbnail.png" src="images/satelites-arriba-tuyo/properties.thumbnail.png"></a>
<p>Elegimos "Map, table, polar and single sat (wide)". Guardamos todo, y listo! Ya tenemos nuestro super dashboard satelital :)</p>
<a class="reference external image-reference" href="images/satelites-arriba-tuyo/todo.png"><img alt="/images/satelites-arriba-tuyo/todo.thumbnail.png" src="images/satelites-arriba-tuyo/todo.thumbnail.png"></a>
<p>Podés dejar de leer en este punto, o si te interesa saber un poco más, debajo explico qué son las cosas más importantes que se ven en el dashboard.</p>
</div>
<div class="section" id="que-estamos-viendo-en-el-mapa">
<h2>Qué estamos viendo en el mapa?</h2>
<p>En el mapa se ven las posiciones de los satélites, y el área de la tierra que ellos "cubren". Imaginate una pelota muy grande (o un planeta, jeje): si estás muy cerca ves poco, pero si te alejás, ves mucho más.
Cuánto ves? Ves una zona de la pelota que tiene forma de círculo. Un radio de X distancia alrededor tuyo.</p>
<p>Con los sates pasa esto mismo: si están muy cerca de la tierra (como los NUSAT), ven menos de ella al mismo tiempo. Si están más lejos (como los ARSAT), ven más.
Dependiendo de qué función tenga el satélite, conviene estar más lejos o más cerca, y no hay una "mejor".
Por ejemplo, no sirve estar super lejos y cubrir un montón si lo que interesa es sacar fotos detalladas de ciudades.
Y no sirve estar re cerca y cubrir poco si lo que interesa es transmitir señales de comunicaciones.</p>
<p>Si dije que el area que cubre tiene forma de círculo, por qué no se ven como círculos en en mapa?
Los ARSAT parecieran cubrir un cuadrado, mientras que los NUSAT ven círculos o cosas más deformes dependiendo del momento!</p>
<p>Eso es culpa de la proyección que usamos en el mapa. El mapa deforma mucho la imagen, la estira más cuanto más cerca estemos del polo.
Si lo viésemos en un globo terraqueo, se verían como círculos.</p>
<p>Cosa extra que se puede ver: si hacemos click derecho en el punto de un satélite, podemos tildar la opción "Ground Track", y eso nos muestra el camino que el satélite va a recorrer
durante las próximas horas. Si lo hacemos para un ARSAT no se va a ver ningún camino, porque son sates que están siempre en el mismo lugar en el cielo! (geoestacionarios).</p>
</div>
<div class="section" id="que-estamos-viendo-alrededor">
<h2>Qué estamos viendo alrededor?</h2>
<p>Al costado hay dos cosas: un gráfico con forma de mira ("vista polar"), y un grupito de datos de un satélite.</p>
<p>El gráfico con forma de mira es el cielo que vemos desde nuestra casa, con las posiciones de los satélites que lleguemos a ver (si es que hay alguno arriba nuestro).
Si por ejemplo vivís en Argentina y pusiste tus coordenadas, deberías siempre poder ver a los dos ARSAT, y de a ratos algún otro.</p>
<p>Los datos que se ven abajo del gráfico son el detalle de algún satélite en particular.
Con el menú que tiene esa sección (botoncito con flecha hacia abajo), podemos elegir qué satélite ver.
Cosa que sorprende a la mayoría de la gente: velocidad de los NUSAT o CUBEBUG, de 7 km/s. O sea, más o menos 23000 km/h.
Un poquito rápido, suficiente como para dar la vuelta al mundo 16 veces por día (lo hacen!).</p>
<p>Otra cosa útil: podemos ver cuándo es la próxima pasada del satélite por encima nuestro (o cuánto tiempo le falta antes de irse de nuestro cielo, si justo está pasando por arriba).
Eso se ve en el campo "Next Event".</p>
<p>Y finalmente, la tabla de abajo es similar al detalle del costado. Solo que muestra datos de varios sates a la vez.</p>
<p>Espero que lo disfruten tanto como yo :)</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/how-to-run-keras-theano-backend-with-a-nvidia-optimus-gpu-using-cuda-under-ubuntu-1604/" class="u-url">How to run Keras (Theano backend) with a Nvidia Optimus gpu using CUDA, under Ubuntu 16.04</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Juan Pedro Fisanotti
            </span></p>
            <p class="dateline"><a href="posts/how-to-run-keras-theano-backend-with-a-nvidia-optimus-gpu-using-cuda-under-ubuntu-1604/" rel="bookmark"><time class="published dt-published" datetime="2016-09-20T22:58:35-03:00" title="2016-09-20 22:58">2016-09-20 22:58</time></a></p>
                <p class="commentline">            <a href="posts/how-to-run-keras-theano-backend-with-a-nvidia-optimus-gpu-using-cuda-under-ubuntu-1604/#disqus_thread" data-disqus-identifier="cache/posts/how-to-run-keras-theano-backend-with-a-nvidia-optimus-gpu-using-cuda-under-ubuntu-1604.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I broke so many things trying to get this to work, that I need to write it down for my future self and any others who might need this.</p>
<p>This tutorial explains how to get a Keras neural network to train using your gpu, or any Theano related code for that matter, but for the special scenario of having a Nvidia Optimus enabled gpu running under Ubuntu 16.04.
Other scenarios:</p>
<ul class="simple">
<li>Under Ubuntu 16.04 and you have a Nvidia gpu which is not Optimus enabled? then some things might work, but the "Nvidia gpu drivers" section won't be useful to you.</li>
<li>Under a different distro or Ubuntu version? I would <strong>not</strong> recommend trying this.</li>
<li>Have an non-Nvidia gpu? this <strong>won't work</strong> at all.</li>
</ul>
<p>Enough presentations, lets get to work.</p>
<div class="section" id="the-example">
<h2>0. The example</h2>
<p>We will need a Keras example to check if things are working well.
Use the code from <a class="reference external" href="https://github.com/fisadev/keras_experiments">this repo</a>.</p>
<p>In that repo you will find a keras experiment (in one of the ipython notebooks), and a small script to check for gpu usage from Theano.
Both will be useful.</p>
<p><strong>Remember</strong> to create a virtualenv and <strong>install its dependencies</strong> (from the <tt class="docutils literal">requirements.txt</tt>).
You can use wheels to speed up the process. And it requires <strong>python 3</strong>.</p>
</div>
<div class="section" id="nvidia-gpu-drivers">
<h2>1. Nvidia gpu drivers</h2>
<p>We need Ubuntu to be able to use our gpu.
To achieve that, we need both the gpu drivers and the Optimus drivers.
Thing is, Optimus drivers are kind of broken right now under Ubuntu 16.04.</p>
<p>But we can get things working, with some small annoyances:</p>
<ol class="arabic simple">
<li>Disconnect any external/secondary monitors.</li>
<li>Install video and optimus drivers: <tt class="docutils literal">sudo apt install <span class="pre">nvidia-361</span> <span class="pre">nvidia-prime</span></tt>
</li>
<li>Reboot your machine and login.</li>
<li>Open the "Nvidia X Server Settings" app, go to the "PRIME Profiles" section and choose "NVIDIA".</li>
<li>Close the settings app.</li>
<li>Logout and login again, so the profile change can take effect.</li>
</ol>
<p><strong>A small annoyance</strong>: while the "NVIDIA" profile is active you cannot (at the moment) use a secondary screen.
It will crash your X server.</p>
<p><strong>Important</strong>: remember to go back to the "Intel" profile whenever you don't want to use your gpu anymore, logout and login back for it to take effect.
Otherwise, your gpu will be using lots of power for nothing.</p>
</div>
<div class="section" id="cuda">
<h2>2. CUDA</h2>
<p>We need to be able to do general purpose computation on our Nvidia gpu.
To achieve that, we need the CUDA toolkit.
Thing is, CUDA has no Ubuntu 16.04 package at the moment.</p>
<p>But we can make things work. This is Linux, after all (thanks to Martin Thoma's <a class="reference external" href="http://askubuntu.com/questions/799184/how-can-i-install-cuda-on-ubuntu-16-04">answer</a>):</p>
<ol class="arabic simple">
<li>Download CUDA from the <a class="reference external" href="https://developer.nvidia.com/cuda-downloads">Nvidia website</a>. Choose the Ubuntu 15.04 "runfile (local)" version.</li>
<li>Check the md5 sum with: <tt class="docutils literal">md5sum cuda_7.5.18_linux.run</tt>. Only continue if it is correct.</li>
<li>Run the installer and follow the instructions: <tt class="docutils literal">sudo sh cuda_7.5.18_linux.run <span class="pre">--override</span></tt>. <strong>Make sure</strong> that you say <strong>y</strong> for the symbolic link, and <strong>n</strong> to the video drivers installation.</li>
</ol>
<p>Don't worry about the warning related to the non-installation of the video drivers.
The script is somewhat dumb and doesn't detect the drivers we installed on the previous section.</p>
</div>
<div class="section" id="gcc-and-g-versions">
<h2>3. Gcc and G++ versions</h2>
<p>Guess what? Yes, more problems.</p>
<p>CUDA requires gcc to be a version up to 4.9.
Later versions won't work.
Ubuntu 16.04 ships with gcc 5.4.</p>
<p>But we can have both versions side by side, and trick CUDA to use the older versions with just some simple symlinks (thanks to <a class="reference external" href="https://twitter.com/_zzzoom_/status/765720104868904964">charlie</a> for the tip, the old solution was far more complicated).</p>
<pre class="code bash"><a name="rest_code_d86c45f324be4963b246afbc408e81a3-1"></a>sudo apt-get install gcc-4.9 g++-4.9
<a name="rest_code_d86c45f324be4963b246afbc408e81a3-2"></a>sudo ln -s /usr/bin/gcc-4.9  /usr/local/cuda/bin/gcc
<a name="rest_code_d86c45f324be4963b246afbc408e81a3-3"></a>sudo ln -s /usr/bin/g++-4.9  /usr/local/cuda/bin/g++
<a name="rest_code_d86c45f324be4963b246afbc408e81a3-4"></a>
<a name="rest_code_d86c45f324be4963b246afbc408e81a3-5"></a><span class="c1"># Work around a glibc bug (according to the theano docs)</span>
<a name="rest_code_d86c45f324be4963b246afbc408e81a3-6"></a><span class="nb">echo</span> -e <span class="s2">"\n[nvcc]\nflags=-D_FORCE_INLINES\n"</span> &gt;&gt; ~/.theanorc
</pre>
</div>
<div class="section" id="testing">
<h2>4. Testing</h2>
<p>Done! You should be able to run Theano things (including Keras neural networks) using your gpu.</p>
<p>A simple way to check if that's true, is to run the <tt class="docutils literal">test_gpu.py</tt> script from the example repo.
But don't just "run" it.
You need to tell Theano "hey, I want you to use my shiny cuda gpu".
To achieve that, run the script like this (inside your virtualenv):</p>
<pre class="code bash"><a name="rest_code_86c52060168449bea7b8ac1449dbfd01-1"></a><span class="nv">THEANO_FLAGS</span><span class="o">=</span><span class="s2">"mode=FAST_RUN,device=gpu,floatX=float32,cuda.root=/usr/local/cuda/"</span> python test_gpu.py
</pre>
<p>If everything is working, it should quickly run and output something which ends with: <tt class="docutils literal">Used the gpu</tt>.
If instead it takes a long time (~1 minute) and ends with <tt class="docutils literal">Used the cpu</tt>, then something is not working.</p>
<p>If that worked, then you can try the full example and play a little with it (should be able to run all lines without errors):</p>
<pre class="code bash"><a name="rest_code_0a5d7b65029048e7ac18ab6047186c93-1"></a><span class="nv">THEANO_FLAGS</span><span class="o">=</span><span class="s2">"mode=FAST_RUN,device=gpu,floatX=float32,cuda.root=/usr/local/cuda/"</span> ipython notebook
</pre>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/suspicious-logins/" class="u-url">Suspicious logins</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Juan Pedro Fisanotti
            </span></p>
            <p class="dateline"><a href="posts/suspicious-logins/" rel="bookmark"><time class="published dt-published" datetime="2016-09-19T20:45:15-03:00" title="2016-09-19 20:45">2016-09-19 20:45</time></a></p>
                <p class="commentline">            <a href="posts/suspicious-logins/#disqus_thread" data-disqus-identifier="cache/posts/suspicious-logins.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="the-interesting-story">
<h2>The "interesting" story</h2>
<p>Imagine having a main gmail account, and a handfull of extra accounts (to reserve names, to test some api stuff, etc).</p>
<p>Imagine not having used those extra accounts in years. And even more: not having used them <strong>ever</strong>. Not a single email sent, not a single external app connected to them, not any login to other sites, etc.</p>
<p>One day you decide to start using a password manager. And an open source one, which stores the data encrypted using gpg. You even create a new gpg key to encrypt them, to be sure it's safe. You sync your encrypted data into an online private git repo, because nobody could decrypt the data anyway.</p>
<p>Two days later, you receive an email from google:</p>
<a class="reference external image-reference" href="images/suspicious-logins/someone_has_your_password.png"><img alt="/images/suspicious-logins/someone_has_your_password.thumbnail.png" src="images/suspicious-logins/someone_has_your_password.thumbnail.png"></a>
<p><strong>PANIC</strong></p>
<p>(worth mentioning: I'm from Argentina, the access was from the US)</p>
<p>After some investigation, you discover:</p>
<ul class="simple">
<li>You were reusing the password from that account.</li>
<li>The way you were using the password manager, the account names weren't encrypted (the passwords were, of course).</li>
<li>By reusing it, the encrypted data is the same in all encrypted files.</li>
<li>You never used the account, but it has your name on it, easily guessable account name.</li>
</ul>
<p><strong>Conclussion</strong>: someone who has your password from another (unsafe?) service, could have either guessed your secondary account name, or gained access to the encrypted data, which has the account names in clear text. By just comparing encrypted contents, not even decrypting them, that person could have known in which other sites the leaked password could work.</p>
<p>Ok, you now think you know, you just need to change passwords on all those sites, and never ever reuse passwords again. But oh no, you know nothing. After doing it, a few days later...</p>
<p>Email: <strong>Someone has your password</strong>.</p>
<p>Again! But this time from a different account: not that one which was easily guessable and which shared the password with other sites. No. This time? An account you <strong>didn't even write down the name</strong>, not in your password manager, nor anywhere outside google itself. The password was written down in your password manager, in clear text, because you were a little clumsy and confused "user" with "password". But then again, you <strong>never wrote down the account name outside google, ever</strong>.</p>
<p>How could someone have gained access to that account? How in hell can someone know you own that account, and he can use that "username" as password for it?</p>
<p>You start to recall... There is only <strong>one</strong> place were you have references to that account: old emails you received in your inbox, when you created the account. <strong>Your inbox</strong>.</p>
<p>Think about it: Google is telling you "hey, someone knows your account and password", and you know that the account name was only present in old emails at your inbox, while the password was only written down in your trusty new password manager.</p>
<a class="reference external image-reference" href="images/suspicious-logins/scared.jpg"><img alt="/images/suspicious-logins/scared.thumbnail.jpg" src="images/suspicious-logins/scared.thumbnail.jpg"></a>
<p>NSA, is that you? Or a random hacker who really wants to steal my data? What valuable data can I have? Hell, I need to get everyone to revoke my credentials everywhere, now.</p>
</div>
<div class="section" id="the-boring-story">
<h2>The "boring" story</h2>
<p>But no. There is always a boring explanation, something simpler, that doesn't look like a CSI Cyber episode. In this case? something that looks like a bug on some internal Google services.</p>
<p>I discovered this almost by chance, while writting down a super comprehensive explanation of the things I was seeing (a 5x longer version of the interesting story). I realized I had both accounts added to my main email account, using gmail's feature to access emails from multiple sources. This feature:</p>
<a class="reference external image-reference" href="images/suspicious-logins/gmail_feature.png"><img alt="/images/suspicious-logins/gmail_feature.thumbnail.png" src="images/suspicious-logins/gmail_feature.thumbnail.png"></a>
<p>I thought: "oh! I forgot to update those settings after changing the passwords". And so I opened gmail, went to the settings, and saw the big red errors telling me that gmail wasn't able to connect to those accounts. Which was to be expected, as I changed the passwords. But something clicked inside my head: since when is gmail unable to check those accounts? what was the error?...</p>
<p>And there it was, the boring truth in all its boringness: gmail wasn't able to access the accounts from the exact same moment the "suspicious logins" happened.</p>
<p>Some might think "oh, that's to be expected as well. Google must have blocked the account as soon as the security incident was detected". But no. This feature doesn't check email every second. For my accounts, it's doing it once every day, more or less. And the failed attempt was at the exact same time the "suspicious login" happened. In <strong>both</strong> accounts. Different times each one. Too much coincidence.</p>
<p>I wasn't able to see the original error for one of the accounts, too many login errors since it because of the password change, and it only stores the last 5 of them. But for the other account the first error was still there, and it was different to the password related ones.</p>
<p>The errors after the password changes were:</p>
<pre class="code text"><a name="rest_code_ca823e3fe8de4cab8f6da0c0e78ab7ea-1"></a>Authentication error.
<a name="rest_code_ca823e3fe8de4cab8f6da0c0e78ab7ea-2"></a>Server returned error "[AUTH] Username and password not accepted."
</pre>
<p>But the error at the same time than the suspicious login was:</p>
<pre class="code text"><a name="rest_code_ea9ef937a02a44478a192ab84a30fc3f-1"></a>Authentication error.
<a name="rest_code_ea9ef937a02a44478a192ab84a30fc3f-2"></a>Server returned error "[AUTH] Web login required: https://support.google.com/mail/answer/78754"
</pre>
<p>The linked support page isn't very helpful, but if you google the error you will find some people having the same issue: after years of not using an account, the login on their pop3 client starts to fail. Maybe something changed in google's security policies, maybe it's related to new terms of service, or required security checkups. But the thing is: logins fail until you login from a browser and tweak some stuff (enabling less secure apps, etc).</p>
<p>That itself isn't the bug. The bug is flagging those pop3 logins which came <strong>from inside google</strong> (it's a gmail feature, running on their servers), as if they were "suspicious logins". They are not suspicious, they are comming from inside google, they are being made from a google server trying to execute a gmail feature.</p>
<p>Finally, how sure am I that the logins came from inside google? Well, a traceroute to the login ip took me to this host: <tt class="docutils literal"><span class="pre">mail-pa0-x218.google.com</span></tt>.</p>
<p>So yes, I'm pretty sure this was a bug. But by Cthulhu's beard, I'm <strong>happy</strong> this was a bug.</p>
</div>
<div class="section" id="in-short">
<h2>In short</h2>
<p>A gmail server tries to login to a gmail account for a gmail feature to work, and the user gets a big red email: "someone has your password". Yes, google, someone has my password. It's you.</p>
</div>
</div>
    </div>
    </article>
</div>

               <script>var disqus_shortname="fisa-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script></main><footer id="footer"><p>Contents © 2017         <a href="mailto:fisadev@gmail.com">Juan Pedro Fisanotti</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
        

        <script src="assets/js/baguetteBox.min.js"></script><script>baguetteBox.run('a.reference', {
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});</script>
</body>
</html>
